<html>
	<head>
		<title>Chromapaper | Options</title>
		<link rel="stylesheet" type="text/css" href="style/main.css">
		<script type="text/javascript">
		
			// TO-DO: Make the HTML of the page dynamic based on the options.
		
			var pages = {
				setup: function() {	
					pages.db = openDatabase('instapaper_reader', '1.0', 'Instapaper Articles', 1024 * 1024);
					pages.db.transaction(function(tx) {
						tx.executeSql("create table if not exists " +
							"pages(id integer primary key asc, article_title string, url string, html string)",
							[],
							function() {console.log("Created/connected to DB");}
							);
					});
				},
				reset: function() {
					console.log("in pages.reset. i'm sure it worked bro");
					pages.db.transaction(function(tx) {
						tx.executeSql('drop table pages',
							[],
							null,
							pages.onError);
					});
					pages.db.transaction(function(tx) {
						tx.executeSql('drop table images',
							[],
							null,
							pages.onError);
					});
				}
			}
			
			// Option object:
			// name - name of option within localStorage
			// type - right now, only "checkbox"... mostly here for future additions
			// defaultStatus - the default status of the object (string always!)
			// inputId - the id of the input tag this object's tied to
			var Option = function (name, type, defaultStatus, inputId) {
			
				this.name = name;
				this.type = type;
				this.defaultStatus = defaultStatus;
				this.inputId = inputId;
				
				console.log(this.name + " " + this.type + " " + this.defaultStatus + " " + this.inputId);
				
				this.load = function () {
					var loadedStatus = localStorage[this.name];
					if (!loadedStatus) {
						this.update(this.defaultStatus);
					}
					else {
						this.changeDisplayedOption(loadedStatus);
					}
				}
				
				//changes the checkbox or field to reflect the loaded option
				this.changeDisplayedOption = function (status) {
					if (this.type == "checkbox") {
						if (status == "true") {
							document.getElementById(this.inputId).checked = true;
						}
						else if (status == "false") {
							document.getElementById(this.inputId).checked = false;
						}
					}
				}
				
				//updates the option
				this.update = function (status) {
					localStorage[this.name] = status;
					this.changeDisplayedOption(status);
				}
				
				//for checkboxes only - just updates to the opposite of what it was
				if (this.type == "checkbox") {
					this.toggle = function () {
						if (localStorage[this.name] == "true") {
							this.update("false");
						}
						else if (localStorage[this.name] == "false") {
							this.update("true");
						}
					}
				}
				

			}
			
			function reset() {
				var r=confirm("Are you sure you want to reset? You will not be able to access your articles until next sync!");
				if (r==true) {
					pages.reset();
				}
			}
			
			function resetFolders() {
				var r=confirm("Are you sure you want to reset folders? You'll need add each one again later.");
				if (r==true) {
					localStorage['folders'] = "";
				}
			}
			
			pages.setup();
			
			// to-do: put these options in an array, since for each will be handy...
			
			var offlineSyncOption = new Option("syncButtonOn","checkbox","true","syncButtonCheckbox");
			var paginationOnlineOption = new Option("paginationOnlineOn","checkbox","false","paginationOnlineCheckbox");
			var paginationOfflineOption = new Option("paginationOn","checkbox","false","paginationCheckbox");
			var saveScrollOption = new Option("scrollTrackingOn","checkbox","false","scrollTrackingCheckbox");
			var saveImagesOption = new Option("saveImagesOn","checkbox","false","saveImagesCheckbox");
			
			loadOptions = function () {
				// ...here
				console.log("loadOptions called");
				offlineSyncOption.load();
				paginationOnlineOption.load();
				paginationOfflineOption.load()
				saveScrollOption.load();
				saveImagesOption.load();
			}
			
		</script>
	</head>
	<body onload="loadOptions()">
	
		<div id="header">
			<div id="userpanel">
				
			</div>
			<h1 id="logo"><span class="logo"><a href="main.html">Chromapaper</a></h1>
			<div style="font-size: 14px; margin-top: 8px;">
				A simple tool to save web pages for reading later.
				
			</div> 
		</div>
		<div id="bookmark_list">
			<div class="tableViewCell tableViewCellFirst" onClick="offlineSyncOption.toggle()" onMouseOver="style.cursor='pointer';this.style.backgroundColor = '#eee';" onMouseOut="this.style.backgroundColor = '#F8F8F8'">
				<div class="cornerControls"></div>
				<div class="starBox"></div>
				<div class="titleRow" style="width:90%;">
					<span class="tableViewCellTitleLink">
						<b>Enable offline sync button</b>
					</span>
					<input type="checkbox" id="syncButtonCheckbox" onClick="" value="yes1"><br>
					<div class="summary">
						Disable if you're not using the offline features of Chromapaper
					</div>
				</div>
				<div class="clear"></div>
			</div>
				<div class="clear"></div>
			<div class="tableViewCell" onClick="saveScrollOption.toggle()" onMouseOver="style.cursor='pointer';this.style.backgroundColor = '#eee';" onMouseOut="this.style.backgroundColor = '#F8F8F8'">
				<div class="cornerControls"></div>
				<div class="starBox"></div>
				<div class="titleRow" style="width:90%;">
					<span class="tableViewCellTitleLink">
						<b>Save scroll position</b> <i>(beta)</i>
					</span>
					<input type="checkbox" id="scrollTrackingCheckbox" value="yes1"><br>
					<div class="summary">
						Saves the scroll position you leave an article at, and reloads to that position when the article is loaded.
					</div>
				</div>
				<div class="clear"></div>
			</div>
			<div class="tableViewCell tableViewCellLast" onClick="saveImagesOption.toggle()" onMouseOver="style.cursor='pointer';this.style.backgroundColor = '#eee';" onMouseOut="this.style.backgroundColor = '#F8F8F8'">
				<div class="cornerControls"></div>
				<div class="starBox"></div>
				<div class="titleRow" style="width:90%;">
					<span class="tableViewCellTitleLink">
						<b>Download Images</b> <i>(alpha)</i>
					</span>
					<input type="checkbox" id="saveImagesCheckbox" value="yes1"><br>
					<div class="summary">
						Downloads article images in offline view. Only works with some images for now; the rest just show up broken.
					</div>
				</div>
				<div class="clear"></div>
			</div>
			
			
			<br>
			
			
			<div class="tableViewCell tableViewCellFirst" onClick="paginationOfflineOption.toggle()" onMouseOver="style.cursor='pointer';this.style.backgroundColor = '#eee';" onMouseOut="this.style.backgroundColor = '#F8F8F8'">
				<div class="cornerControls"></div>
				<div class="starBox"></div>
				<div class="titleRow" style="width:90%;">
					<span class="tableViewCellTitleLink">
						<b>Offline two-column pagination</b>
					</span>
					<input type="checkbox" id="paginationCheckbox" value="yes1"><br>
					<div class="summary">
						Use left and right keys to navigate. Works great on CR-48. 
					</div>
				</div>
				<div class="clear"></div>
			</div>
			<div class="tableViewCell tableViewCellLast" onClick="paginationOnlineOption.toggle()" onMouseOver="style.cursor='pointer';this.style.backgroundColor = '#eee';" onMouseOut="this.style.backgroundColor = '#F8F8F8'">
				<div class="cornerControls"></div>
				<div class="starBox"></div>
				<div class="titleRow" style="width:90%;">
					<span class="tableViewCellTitleLink">
						<b>Online two-column pagination</b>
					</span>
					<input type="checkbox" id="paginationOnlineCheckbox" value="yes1"><br>
					<div class="summary">
						Pagination in the online Instapaper text view.
					</div>
				</div>
			</div>
			
			
			<br>
			
			
			<div class="tableViewCell tableViewCellFirst" onClick="resetFolders()" onMouseOver="style.cursor='pointer';this.style.backgroundColor = '#eee';" onMouseOut="this.style.backgroundColor = '#F8F8F8'">
				<div class="cornerControls"></div>
				<div class="starBox"></div>
				<div class="titleRow" style="width:90%;">
					<span class="tableViewCellTitleLink">
						<b>Clear folders</b>
					</span>
					<div class="summary">
						Clears the folders that are set to sync. Do this if you change accounts.
					</div>
				</div>
				<div class="clear"></div>
			</div>
			<div class="tableViewCell tableViewCellLast" onClick="reset()" onMouseOver="style.cursor='pointer';this.style.backgroundColor = '#eee';" onMouseOut="this.style.backgroundColor = '#F8F8F8'">
				<div class="cornerControls"></div>
				<div class="starBox"></div>
				<div class="titleRow" style="width:90%;">
					<span class="tableViewCellTitleLink">
						<b>Clear saved articles</b>
					</span>
					<div class="summary">
						If something's super messed up with your article list, reseting and syncing again might fix it.
					</div>
				</div>
				<div class="clear"></div>
			</div>
		</div>
		<p style="font-size: 14px;line-height:18px;margin-top:20px;">
		
		<b>Notice: Chromapaper is not an official product of Instapaper, LLC. If you need support, please don't go to them looking for it!</b> Instead, <a href="mailto:thomas@mream.net">email me</a> at thomas@mream.net.<br /><br />
		
		Looking for "Read Later" or "Instapaper Text" buttons? Grab the bookmarklets at <a href="http://www.instapaper.com/extras">instapaper.com/extras</a>. Using the Instapaper Text bookmarklet with online pagination turned on allows you to paginate any article without saving it to your articles list.<br /><br />
		
		Like Instapaper? Support it with an <a href="http://www.instapaper.com/subscription">Instapaper subscription</a>.<br /><br />
		Like Chromapaper? Support it with <a href="http://thomas.mream.net/wordpress/?page_id=41">a donation</a> or with <a href="https://chrome.google.com/webstore/detail/lpjpjcgbkjefppoahpegfajifjdmcblb">a review at the Chrome Web Store</a>. Feel free to <a href="mailto:thomas@mream.net">email me</a> at thomas@mream.net with bug reports or other feedback. And you can always <a href="http://twitter.com/#!/thomasapps">follow me on Twitter for updates</a>.</p>
		<div id="footer"> 
			<div style="margin-top:1em;">
				Unofficial Chrome app by <a href="http://thomas.mream.net">Thomas</a> | Instapaper &copy;&nbsp;2010 Instapaper, LLC.
			</div> 
		</div>
	</body>
</html>
